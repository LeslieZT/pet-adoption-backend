// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Department {
  departmentId Int        @id @default(autoincrement()) @map("department_id")
  name         String
  code         String
  provinces    Province[]
  districts    District[]
  createdAt    DateTime?  @default(now()) @map("created_at")
  updatedAt    DateTime?  @updatedAt @map("updated_at")

  @@map("departments")
}

model Province {
  provinceId   Int        @id @default(autoincrement()) @map("province_id")
  name         String
  code         String
  departmentId Int        @map("department_id")
  department   Department @relation(fields: [departmentId], references: [departmentId])
  districts    District[]
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime?  @updatedAt @map("updated_at")

  @@map("provinces")
}

model District {
  districtId   Int        @id @default(autoincrement()) @map("district_id")
  name         String
  code         String
  provinceId   Int        @map("province_id")
  province     Province   @relation(fields: [provinceId], references: [provinceId])
  departmentId Int        @map("department_id")
  department   Department @relation(fields: [departmentId], references: [departmentId])
  users        User[]
  shelters     Shelter[]
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime?  @updatedAt @map("updated_at")

  @@map("districts")
}

model User {
  userId       String        @id @default(dbgenerated("gen_random_uuid()")) @map("user_id") @db.Uuid
  channel      String
  firstName    String        @map("first_name")
  lastName     String        @map("last_name")
  email        String
  password     String
  avatar       Json?
  phone        String?
  birthdate    DateTime?     @db.Date
  address      String?
  districtId   Int?          @map("district_id")
  district     District?     @relation(fields: [districtId], references: [districtId])
  donations    Donation[]
  shelters     Shelter[]
  adoptions    Adoption[]
  favoritePets FavoritePet[]
  customerId   String?       @map("customer_id")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime?     @updatedAt @map("updated_at")

  @@map("users")
}

model Plan {
  planId           Int        @id @default(autoincrement()) @map("plan_id")
  productId        String     @map("product_id")
  codeOneTime      String     @map("code_one_time")
  codeSubscription String     @map("code_subscription")
  name             String
  title            String
  description      String
  price            Decimal    @db.Decimal(6, 2)
  isPolular        Boolean    @map("is_polular")
  donations        Donation[]
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime?  @updatedAt @map("updated_at")

  @@map("plans")
}

model Donation {
  donationId String    @id @default(dbgenerated("gen_random_uuid()")) @map("donation_id") @db.Uuid
  planId     Int?      @map("plan_id")
  plan       Plan?     @relation(fields: [planId], references: [planId])
  userId     String?   @map("user_id") @db.Uuid
  user       User?     @relation(fields: [userId], references: [userId])
  email      String?
  name       String?
  amount     Decimal   @db.Decimal(6, 2)
  type       String
  status     String
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime? @updatedAt @map("updated_at")

  @@map("donations")
}

model Shelter {
  shelterId  String    @id @default(dbgenerated("gen_random_uuid()")) @map("shelter_id") @db.Uuid
  name       String
  address    String
  phone      String
  email      String
  latitude   Decimal
  longitude  Decimal
  districtId Int       @map("district_id")
  district   District  @relation(fields: [districtId], references: [districtId])
  userId     String?   @map("user_id") @db.Uuid
  user       User?     @relation(fields: [userId], references: [userId])
  pets       Pet[]
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime? @updatedAt @map("updated_at")


  @@map("shelters")
}

model PetCategory {
  petCategoryId Int        @id @default(autoincrement()) @map("pet_category_id")
  name          String
  pets          Pet[]
  breeds        PetBreed[]
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime?  @updatedAt @map("updated_at")

  @@map("pet_categories")
}

model PetBreed {
  petBreedId Int         @id @default(autoincrement()) @map("pet_breed_id")
  name       String
  categoryId Int         @map("category_id")
  category   PetCategory @relation(fields: [categoryId], references: [petCategoryId])
  pets       Pet[]
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime?   @updatedAt @map("updated_at")

  @@map("pet_breeds")
}

model Pet {
  petId          Int           @id @default(autoincrement()) @map("pet_id")
  name           String
  description    String
  birthdate      DateTime
  weight         Decimal       @db.Decimal(6, 2)
  height         Decimal       @db.Decimal(6, 2)
  gender         String
  color          String
  behavior       String[]
  profilePicture Json?         @map("profile_picture")
  categoryId     Int           @map("category_id")
  category       PetCategory   @relation(fields: [categoryId], references: [petCategoryId])
  breedId        Int           @map("breed_id")
  breed          PetBreed      @relation(fields: [breedId], references: [petBreedId])
  shelterId      String        @map("shelter_id") @db.Uuid
  shelter        Shelter       @relation(fields: [shelterId], references: [shelterId])
  photos         PetPhoto[]
  adoptions      Adoption[]
  favoritePets   FavoritePet[]
  status         String        @default("Available")  // 'Available' | 'Adopted'; 
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime?     @updatedAt @map("updated_at")

  @@map("pets")
}

model PetPhoto {
  id        Int       @id @default(autoincrement())
  petId     Int       @map("pet_id")
  pet       Pet       @relation(fields: [petId], references: [petId])
  url       Json?
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")

  @@map("pet_photos")
}

model Adoption {
  adoptionId  String    @id @default(dbgenerated("gen_random_uuid()")) @map("adoption_id") @db.Uuid
  application Json
  status      String
  petId       Int       @map("pet_id")
  pet         Pet       @relation(fields: [petId], references: [petId])
  userId      String    @map("user_id") @db.Uuid
  user        User      @relation(fields: [userId], references: [userId])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime? @updatedAt @map("updated_at")

  @@map("adoptions")
}

model FavoritePet {
  favoritePetId Int       @id @default(autoincrement()) @map("favorite_pet_id")
  petId         Int       @map("pet_id")
  pet           Pet       @relation(fields: [petId], references: [petId])
  userId        String    @map("user_id") @db.Uuid
  user          User      @relation(fields: [userId], references: [userId])
  value         Boolean
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime? @updatedAt @map("updated_at")

  @@map("favorite_pets")
}
